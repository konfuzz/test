name: Notify on README change in Examples

on:
  push: # –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ª—é–±–æ–π –ø—É—à
    branches:
      - main  # –∏–ª–∏ —Ç–≤–æ—è –≤–µ—Ç–∫–∞

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v3
        with:
          fetch-depth: 2

      - name: Get changed README files
        id: changes
        run: |
          CHANGES=$(git diff --name-status HEAD^ HEAD | grep -iE '^Examples/.+/README\.md$' || true)
          echo "files=$CHANGES" >> "$GITHUB_OUTPUT"

      - name: Notify Telegram if README changed
        if: steps.changes.outputs.files != ''
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          CHANGES=$(git diff --name-status HEAD^ HEAD | grep -iE '^Examples/.+/README\.md$' || true)
          MESSAGE="üìÅ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ Examples/README.md:%0A"
          while read -r line; do
            STATUS=$(echo "$line" | awk '{print $1}')
            FILE=$(echo "$line" | awk '{print $2}')
            case $STATUS in
              A) MESSAGE+="‚ûï –î–æ–±–∞–≤–ª–µ–Ω: $FILE%0A" ;;
              M) MESSAGE+="‚úèÔ∏è –ò–∑–º–µ–Ω—ë–Ω: $FILE%0A" ;;
              D) MESSAGE+="‚ùå –£–¥–∞–ª—ë–Ω: $FILE%0A" ;;
              *) MESSAGE+="üìÑ $STATUS: $FILE%0A" ;;
            esac
          done <<< "$CHANGES"
          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d text="$MESSAGE"
