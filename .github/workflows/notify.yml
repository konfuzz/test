name: Notify on README change in Examples

on:
  push:
    paths:
      - 'Examples/**/README.md'
      - 'examples/**/readme.md' # –µ—Å–ª–∏ –ø—É—Ç–∏ –±—ã–≤–∞—é—Ç –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # üí° –≤–∞–∂–Ω–æ: –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —á–µ–º 1, —á—Ç–æ–±—ã git diff —Ä–∞–±–æ—Ç–∞–ª

      - name: Get changed files
        id: changes
        run: |
          CHANGES=$(git diff --name-status HEAD^ HEAD | grep -i 'examples/.*/readme.md' || true)
          echo "files=$CHANGES" >> "$GITHUB_OUTPUT"

      - name: Notify Telegram if README changed
        if: steps.changes.outputs.files != ''
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          CHANGES=$(git diff --name-status HEAD^ HEAD | grep -i 'examples/.*/readme.md' || true)
          MESSAGE="üìÅ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ Examples/README.md:%0A"
          while read -r line; do
            STATUS=$(echo "$line" | awk '{print $1}')
            FILE=$(echo "$line" | awk '{print $2}')
            case $STATUS in
              A) MESSAGE+="‚ûï –î–æ–±–∞–≤–ª–µ–Ω: $FILE%0A" ;;
              M) MESSAGE+="‚úèÔ∏è –ò–∑–º–µ–Ω—ë–Ω: $FILE%0A" ;;
              D) MESSAGE+="‚ùå –£–¥–∞–ª—ë–Ω: $FILE%0A" ;;
              *) MESSAGE+="üìÑ $STATUS: $FILE%0A" ;;
            esac
          done <<< "$CHANGES"
          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d text="$MESSAGE"
